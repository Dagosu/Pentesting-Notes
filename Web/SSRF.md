# Server-side Request Forgery
**Server-side Request Forgery** (SSRF) is a vulnerability in web applications whereby an attacker can make further HTTP requests through the server. An attacker can make use of this vulnerability to communicate with any internal services on the server's network which are generally protected by firewalls.
![](../Media/20220320134734.png)
An attacker finds an **SSRF** vulnerability on a website. The firewall allows all requests to the website. The attacker then exploits the **SSRF** vulnerability by forcing the webserver to request data from the database, which it then returns to the attacker. Because the request is coming from the webserver, rather than directly from the attacker, the firewall allows this to pass.

## Cause of the vulnerability
The main cause of the vulnerability is blindly trusting input from a user. In the case of an **SSRF** vulnerability, a user would be asked to input a URL (or maybe an IP address), then the web application would use that to make a request.

##### Examples
1. **PHP**: Assume there is an application that takes the URL for an image, which the web page then displays for you. The vulnerable SSRF code would look like this:
	```
	<?php
	if (isset($_GET['url']))
	{
	$url = $_GET['url'];
	$image = fopen($url, 'rb');
	header("Content-Type: image/png");
	fpassthru($image);
	}
	```

2. **Python**: 
	```
	from flask import Flask, request, render_template, redirect
	import requests
	
	
	app = Flask(__name__)
	@app.route("/")
	
	def start():
	url = request.args.get("id")
	r = requests.head(url, timeout=2.000)
	return render_template("index.html", result = r.content)
	
	if __name__ == "__main__":
	
	app.run(host = '0.0.0.0')
	```

## Payloads
1. **Port scanning**
	1. `http://127.0.0.1:3306` - search for MySQL DB
	2. Bypass "localhost" or "127.0.0.1" sanitization
		- IPv6 version: `http://[::]:3306` or `http://:::3306`
	    - Encode the IPv6 either into a decimal format or a hexadecimal format
		    - script: https://gist.github.com/mzfr/fd9959bea8e7965d851871d09374bb72
2. **Reading files**
	- `file:///etc/passwd`